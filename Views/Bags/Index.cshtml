@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment WebHostEnvironment

@using DiscBudV1.Areas.Identity.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using DiscBudV1.Controllers
@using DiscBudV1.Models
@using Microsoft.AspNetCore.Mvc

@model List<DiscBudV1.ViewModels.BagDashboardViewModel>
@* @model IEnumerable<DiscBudV1.Models.Bag> *@
@* @model IEnumerable<DiscBudV1.Models.Invdisc> *@


@{
ViewData["Title"] = "Index";
}
 
<div class="container py-5">
    <h1 class="mb-3">My Bag</h1>
    <form id="searchForm" class="mb-3">
        <div class="form-group mr-2 mb-3">
            <input type="text"
                   id="searchInput"
                   class="form-control"
                   placeholder="Search by name, type, or characteristics" />
        </div>
        <div id="filterButtons" class="btn-group" role="group" aria-label="Filter by type">
            <button type="button" class="btn btn-outline-primary filter-btn" data-type="all">All</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-type="driver">Driver</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-type="midrange">Midrange</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-type="putter">Putter</button>
        </div>
    </form>

    @if (User.IsInRole("Admin"))
    {
        <p>
            <a asp-action="Create" class="btn btn-sm btn-primary">Create New</a>
        </p>
    }
<div class="row" id="discsContainer">
    @foreach (var item in Model)
    {
        <div class="col-md-4 col-sm-6 mb-4 disc-item" data-type="@item.Disc?.Type.ToLower()">
            <div class="card disc-card">
                <div class="card-body">
                    <h5 class="card-title">
                        @item.Disc?.Name
                        @if (@item.Disc.Characteristics.Contains("Stable"))
                        {
                            <span>&#x2191;</span> <!-- Up arrow for stable discs -->
                        }
                        else if (@item.Disc.Characteristics.Contains("Overstable") || @item.Disc.Characteristics.Contains("Slightly overstable"))
                        {
                            <span>&#x2192;</span> <!-- Right arrow for overstable discs -->
                        }
                        else if (@item.Disc.Characteristics.Contains("Understable") || @item.Disc.Characteristics.Contains("Slightly understable"))
                        {
                            <span>&#x2190;</span> <!-- Left arrow for understable discs -->
                        }
                    </h5>
                    <p class="card-text">
                        @item.Disc?.Speed / @item.Disc?.Glide / @item.Disc?.Turn / @item.Disc?.Fade
                    </p>
                    <div class="d-flex">
                        <button class="btn btn-info btn-sm toggle-details" data-toggle="collapse" data-target="#details-@item.Disc?.Id">Details</button>
                            <a asp-action="Delete" asp-route-id="@item.Bag.BagId" class="btn btn-danger btn-sm">
                                <i class="fa-solid fa-trash-can"></i>
                            </a>
                    </div>
                </div>
                <div class="card-footer collapse" id="details-@item.Disc?.Id">
                    <p><strong>Manufacturer:</strong> @item.Disc?.Manufacturer</p>
                    <p><strong>Type:</strong> @item.Disc?.Type</p>
                    <p><strong>Characteristics:</strong> @item.Disc?.Characteristics</p>
                </div>
            </div>
        </div>
    }
</div>
@section scripts {
    <script>
        $(document).ready(function () {
            function filterDiscs() {
                var searchText = $('#searchInput').val().toLowerCase().trim();
                var selectedType = $('.filter-btn.active').data('type');

                $('.disc-item').each(function () {
                    var cardText = $(this).text().toLowerCase();
                    var matchFound = false;

                    // Get characteristics text from the .card-footer and split into individual characteristics
                    var characteristicsText = $(this).find('.card-footer p:contains("Characteristics:")').text().toLowerCase();
                    var characteristicsArray = characteristicsText.replace('characteristics:', '').split(',').map(s => s.trim());

                    // Check for search text match
                    if (searchText) {
                        if (searchText === 'stable') {
                            matchFound = characteristicsArray.includes('stable');
                        } else if (searchText === 'overstable') {
                            matchFound = characteristicsArray.includes('overstable') || characteristicsArray.includes('slightly overstable');
                        } else if (searchText === 'understable') {
                            matchFound = characteristicsArray.includes('understable') || characteristicsArray.includes('slightly understable');
                        } else {
                            matchFound = cardText.includes(searchText);
                        }
                    } else {
                        matchFound = true; // Show all if search text is empty
                    }

                    // Check for type match
                    var discType = $(this).data('type');
                    if (selectedType !== 'all' && selectedType !== discType) {
                        matchFound = false;
                    }

                    $(this).toggle(matchFound);
                });
            }

            $('#searchInput').on('input', function () {
                filterDiscs();
            });

            $('.filter-btn').on('click', function () {
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                filterDiscs();
            });

            $(".toggle-details").on("click", function () {
                var target = $(this).data("target");
                $(target).collapse("toggle");
            });

            // Set initial active filter to 'All'
            $('.filter-btn[data-type="all"]').addClass('active');
        });
    </script>
}




@* <table class="table"> 
    <thead>
        <tr>
            <th>
                 @Html.DisplayNameFor(item => item.User) 
                User Id
            </th>
            <th>
                 @Html.DisplayNameFor(item => item.Invdisc) 
                Disc Name
            </th>
            <th>
                Actions
            </th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                @* @Html.DisplayFor(modelItem => item.BagId) 
                @item.Bag.UserId
            </td>
            <td>
                @* @Html.DisplayFor(modelItem => item.BagId) 
                @item.Disc?.Name
                @item.Disc?.Glide
            </td> 
                <td>
                  @*   @Html.DisplayFor(modelItem => item.Invdisc) 
                </td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.Bag.BagId">Edit</a> |
                <a asp-action="Details" asp-route-id="@item.Bag.BagId">Details</a> |
                <a asp-action="Delete" asp-route-id="@item.Bag.BagId">Delete</a>
            </td>
        </tr>
@*     </tbody>
</table>  *@
